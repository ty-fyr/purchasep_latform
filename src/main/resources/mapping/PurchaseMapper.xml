<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.purchase.mapper.PurchaseMapper">
  <resultMap id="BaseResultMap" type="com.hospital.purchase.domain.Purchase">
    <id column="pur_id" jdbcType="INTEGER" property="purId" />
    <result column="pi_id" jdbcType="VARCHAR" property="piId" />
    <result column="drug_id" jdbcType="INTEGER" property="drugId" />
    <result column="result" jdbcType="INTEGER" property="result" />
    <result column="opinion" jdbcType="VARCHAR" property="opinion" />
    <result column="hospital_id" jdbcType="INTEGER" property="hospitalId" />
    <result column="Purchase_number" jdbcType="INTEGER" property="purchaseNumber" />
    <result column="Purchase_name" jdbcType="VARCHAR" property="purchaseName" />
    <result column="start_time" jdbcType="DATE" property="startTime" />
    <result column="over_time" jdbcType="DATE" property="overTime" />
    <result column="activate_time" jdbcType="DATE" property="activateTime" />
    <result column="submit_time" jdbcType="DATE" property="submitTime" />
    <result column="assessor_time" jdbcType="DATE" property="assessorTime" />
    <result column="descrip_id" jdbcType="INTEGER" property="descripId" />
    <result column="isdel" jdbcType="INTEGER" property="isdel" />
    <result column="auditor" jdbcType="VARCHAR" property="auditor" />
    <result column="contacts" jdbcType="VARCHAR" property="contacts" />
    <result column="contactsph" jdbcType="VARCHAR" property="contactsph" />
    <result column="supplier_id" jdbcType="INTEGER" property="supplierId" />
    <result column="ti_id" jdbcType="INTEGER" property="tiId" />
    <association property="transaction" javaType="com.hospital.purchase.domain.TransactionInfo">
      <id column="ti_id" jdbcType="INTEGER" property="tiId" />
      <result column="supply_status" jdbcType="INTEGER" property="supplyStatus" />
      <result column="order_quantity" jdbcType="INTEGER" property="orderQuantity" />
      <result column="order_amount" jdbcType="DECIMAL" property="orderAmount" />
      <result column="delivery_volume" jdbcType="INTEGER" property="deliveryVolume" />
      <result column="delivery_amount" jdbcType="DECIMAL" property="deliveryAmount" />
      <result column="return_ number" jdbcType="INTEGER" property="returnNumber" />
      <result column="settlement_number" jdbcType="INTEGER" property="settlementNumber" />
      <result column="settlement_amount" jdbcType="DECIMAL" property="settlementAmount" />
      <result column="pi_id" jdbcType="INTEGER" property="piId" />
      <result column="isdel" jdbcType="INTEGER" property="isdel" />
    </association>
  </resultMap>

    <!--按照采购单查询..-->
  <select id="selectByPrimaryName" resultMap="BaseResultMap" >
SELECT
	p.hospital_id,
	p.Purchase_number,
	p.Purchase_name,
	p.descrip_id,
	p.start_time,
	p.over_time,
	p.activate_time,
	p.submit_time,
	p.assessor_time,
	t.order_quantity,
	t.order_amount,
	t.delivery_volume,
	t.delivery_amount,
	t.`return_ number`,
	t.settlement_number,
	t.settlement_amount
    FROM
	`purchase` p
	LEFT JOIN transaction_info t ON p.pi_id = t.pi_id
  </select>
  <!--模糊查询-->
  <select id="selectByMHCX" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    SELECT
    *
    FROM
    purchase p,
    transaction_info t
    <if test="purchaseNumber !=null " >
      AND Purchase_number LIKE concat('%',#{purchaseNumber},'%')
    </if>
    <if test="purchaseName != null " >
      AND Purchase_name LIKE concat('%',#{purchaseName},'%')
    </if>
    <if test="hospitalId != null " >
      AND hospital_id LIKE concat('%',#{hospitalId},'%')
    </if>
  </select>










    <!--查询全部采购单信息-->
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT
        p.`pi_id`,
        p.`Purchase_number`,
        p.`Purchase_name`,
        h.`hospital_name`,
        p.`descrip_id`,
        p.`start_time`,
        p.`over_time`,
        p.`activate_time`,
        p.`submit_time`,
        p.`assessor_time`,
        ti.`order_amount`,
        ti.`order_quantity`
    FROM purchase p
    LEFT JOIN hospital h ON p.`hospital_id`=h.`hospital_id`
    LEFT JOIN transaction_info ti ON p.`pi_id`= ti.`pi_id`
    </select>
 <!--动态查询-->
    <select id="selectBySearchBean" resultMap="BaseResultMap">
        SELECT
        p.`pi_id`,
        p.`Purchase_number`,
        p.`Purchase_name`,
        h.`hospital_name`,
        p.`descrip_id`,
        p.`start_time`,
        p.`over_time`,
        p.`activate_time`,
        p.`submit_time`,
        p.`assessor_time`,
        ti.`order_amount`,
        ti.`order_quantity`
        FROM purchase p
        LEFT JOIN hospital h ON p.`hospital_id`=h.`hospital_id`
        LEFT JOIN transaction_info ti ON p.`pi_id`= ti.`pi_id`
        WHERE
        <if test="purchaseNumber != null and purchaseNumber !=''">
            and p.Purchase_number like ('%',#{purchaseNumber},'%')
        </if>
        <if test="purchaseName != null and purchaseName!=''">
            and p.Purchase_name like ('%',#{purchaseName},'%')
        </if>
        <if test="hospitalName !=null and hospitalName!=''">
            and h.hospital_name like ('%',#{hospitalName},'%')
        </if>

    </select>
</mapper>